<?php

namespace Opentest;

use Silex\Application;
use Silex\ServiceProviderInterface;

class GearmanServiceProvider implements ServiceProviderInterface
{
    public function register(Application $app)
    {
        $app['gearman.options'] = [
            'host' => '127.0.0.1',
            'port' => 4730
        ];

        $app['gearman.worker_class'] = '\GearmanWorker';
        $app['gearman.worker'] = $app->share(function () use ($app) {
            $worker = new $app['gearman.worker_class']();
            $worker->addServer($app['gearman.options']['host'], $app['gearman.options']['port']);

            return $worker;
        });

        $app['gearman.client_class'] = '\GearmanClient';
        $app['gearman.client'] = $app->share(function () use ($app) {
            $client = new $app['gearman.client_class']();
            $client->addServer($app['gearman.options']['host'], $app['gearman.options']['port']);

            return $client;
        });
    }

    public function boot(Application $app)
    {

    }
}
