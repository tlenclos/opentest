var env = process.env.NODE_ENV || 'dev';
var config = require('../app/config/' + env + '.json');
var LOCAL_PORT = parseInt(config['socket.server'].port);
var SOCKET_IO_PORT = parseInt(config['socket.client'].port);
var ioClients = [];

var io = require('socket.io').listen(SOCKET_IO_PORT);

var server = require('net').createServer(function (socket) {
    socket.on('data', function (msg) {
        ioClients.forEach(function (ioClient) {
            ioClient.emit('log', msg.toString().trim());
        });
    });
}).listen(LOCAL_PORT);

io.sockets.on('connection', function (socketIo) {
    console.log('client connected');
    ioClients.push(socketIo);
});

server.on('listening', function () {
    console.log("TCP server accepting connection on port: " + LOCAL_PORT);
});